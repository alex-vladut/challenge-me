## Add fields used by `dynamodb-geo` library for querying

Add the following fields to your schema.graphql:
```
  hashKey: Int!
  rangeKey: String!
  geohash: Int!
```
As we will want to create indexes on those fields they have to be marked as required. If you already have data you'll have to perform a migration to properly populate those fields.

## Add GSIs

Next we will define 2 GSIs according to the way dynamodb-geo library requires in order to perform those queries:
```
  @key(name: "geo-hash-range-index", fields: ["hashKey", "rangeKey"], queryField: "byGeolocation")
  @key(name: "geohash-index", fields: ["hashKey", "geohash"], queryField: "byHashByGeohash")
```
You need to specify the `queryField` on both keys as otherwise you'll get a strange error from Amplify:
```
Attempting to edit the key schema of the ActivityTable table in the Activity stack. 
An error occured during the push operation: Attempting to edit the key schema of the ActivityTable table in the Activity stack. 
```
We are not using those queries, but if Amplify needs them that's it. Another thing here is that I added those indexes one by one, just to make sure everything works as expected. I don't know if it works to add them both at the same time.

## Implement `createActivity` mutation

Now we won't be able to use the resolver automatically generated by Amplify for creating a new activity because we want to populate those additional fields added in the previous steps. This will be performed by making use of an NPM package called `dynamodb-geo`. In order to do that we'll define a custom Lambda Function resolver.
Let's first add our Lambda function. Type the following command and follow the instructions:
```
amplify function add
```
After adding the Lambda function and implementing it to create a new item which includes geolocation fields, the next step we have to do is to link it to a resolver in `schema.graphql` so that AppSync knows to invoke it.
First prevent Amplify from generating a resolver by setting `mutations: null`, and then define your new mutation:
```
type Mutation {
  createActivity(input: CreateActivityInput!): Activity! @function(name: "create-activity-${env}")
}
```

 ## Add resolver to search by geolocation

Create another Lambda function and a resolver for this query.