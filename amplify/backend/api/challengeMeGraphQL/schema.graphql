type User
  @model
  @versioned
  @auth(rules: [{ allow: owner, ownerField: "id", operations: [update] }, { allow: private, operations: [read] }]) {
  id: ID!
  name: String!
  pictureUrl: AWSURL
  email: AWSEmail
  activities: [Participation!] @connection(name: "UserActivities")
}

type Activity
  @model(mutations: { create: "createActivity" }, subscriptions: null)
  @searchable
  @auth(
    rules: [
      { allow: owner, ownerField: "activityOwnerId", operations: [create] }
      { allow: private, operations: [read] }
    ]
  )
  @versioned {
  id: ID!
  owner: User @connection
  description: String!
  sport: String!
  dateTime: AWSDateTime!
  numberOfAttendants: Int!
  location: Location!
  address: String! # human readable address (can't include it in Location because ES breaks)
  participations: [Participation!] @connection(name: "ActivityParticipants")
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
}

type Location {
  lat: Float!
  lon: Float!
}

type Participation @model @auth(rules: [{ allow: private }]) @auth(rules: [{ allow: private }]) @versioned {
  id: ID!
  activity: Activity! @connection(name: "ActivityParticipants")
  participant: User! @connection(name: "UserActivities")
  status: ParticipationStatus!
}

enum ParticipationStatus {
  ACCEPTED
  REJECTED
}

input DeleteActivityInput {
  id: ID!
}

type Mutation {
  deleteActivity(input: DeleteActivityInput!): Activity!
    @function(name: "delete-activity-${env}")
    @function(name: "delete-participations-${env}")
}

input LocationInput {
  lat: Float!
  lon: Float!
}

type ActivityConnection {
  items: [Activity]
  total: Int
  nextToken: String
}

type Query {
  nearbyActivities(location: LocationInput!, km: Int): ActivityConnection
}
